---
title: IoT を使ってみる（その１：AWS IoT チュートリアル編）
author: shuichi-takatsu
date: 2022-09-04
tags: AWS 
image: true
---

「IoT」という言葉が世の中に広まって、結構な時間が経ったと思います。  
私達が日頃「ああ、これがIoTだ」と実感することはそれほど多くないと思いますが、IoTは私達の生活の中に着実に広がっています。  
今回から数回に分けて、AWS(アマゾン・ウェブ・サービス)の「AWS IoT」とIoTデバイスの「Raspberry Pi」を使って、IoTについて紹介していきたいと思います。  
また必要に応じて他社のIoTサービスやIoTデバイスについても比較検討してみたいと思います。


## IoT とは

IoT とは、今までインターネットにそれほど縁のなかった様々な”モノ”が、インターネットという通信網を介して相互に接続され、情報をやり取りしたり、制御したりする仕組みの総称です。  
IoTは”Internet of Things”の略であり、日本語だと”モノのインターネット”と訳されます。  
(IoTを日本語にした瞬間に、何故かダサい響きを感じるのは私だけでしょうか…)

IoTの”T”は ”Things” のことであって、安易に ”Devices” とかにしなかったところに「これまでとは違ったインターネットの活用法」という雰囲気を感じます。

”モノ(Things)”には様々なものがあり、車はもちろん、家電製品、照明機器、ガスメーターなど、幅広い分野に及びます。

大量の多種多様な”モノ”が相互に接続されることによって、これまで収集が困難だったデータを大量かつ広範囲に収集・分析・処理することによって、高度な制御・監視が可能になります。

## AWS IoT とは

IoTは概念ですが、この概念を現実世界の製品・サービスとして世の中に送り出している企業は沢山あります。  
その先頭を走っている企業の一つが”Amazon”です。  
一般の人ならば”Amazon”と聞くと「ネットで便利にお買い物ができるサイトを展開している企業」というイメージが強いと思いますが、Amazonの収益の多くはクラウドサービスが叩き出しています。  

そのAmazonが提供するクラウドサービスがAWS(アマゾン・ウェブ・サービス)です。  

そして、AWSの中で「IoT」に特化したサービス・仕組みのことを「AWS IoT」と呼びます。  

AWS IoTは、AWSの中で提供されている様々なサービスを利用することができ、複数のIoTデバイスからデータを収集・分析し、IoTデバイスの管理・制御を行うことができます。

## IoTデバイス とは

IoTの主役は２つあると思っています。  

一つはもちろん”インターネット”です。  
そして、もう一つは”モノ”です。  

これまで単独で動作していた”モノ”がインターネットに接続されることで応用範囲が非常に広くなりました。  
”モノ”に相当する機器をIoTデバイスと呼称するようです。  
これらのIoTデバイスはインターネットに接続するための固有のアドレスを持ち、インターネットを介して情報の送受信や制御の実行を行います。  

IoTデバイスには
- 監視／制御と、インターネット(クラウド)との情報のやり取りの両方を行うもの
- インターネット(クラウド)との情報のやり取りのみに特化したもの

があり、後者を「IoTゲートウェイ」と呼んだりもします。

## 安価なIoTデバイスとしての「Raspberry Pi」と「Arduino」

Raspberry PiはARMプロセッサを搭載したシングルボードコンピュータです。  
イギリスのラズベリーパイ財団によって開発されており、教育用／実務用の両方に広く使用されています。  
高性能の割に価格が非常に安価であり、IoTマニア(？)には御用達の機器でしょう。  
microSDカードにOS(Linux系OSのRaspbianがよく使われます)を入れて、マウス・キーボード、外部LCD等を接続すれば立派なパソコンになります。

もともと教育・ホビー用途で利用されることが多かったのですが、IoTの普及にともなってその存在がクローズアップされた感じです。  

Raspberry Piの詳細については[ここ](https://ja.wikipedia.org/wiki/Raspberry_Pi)を御覧ください。  

筆者も自宅に一台持っています。  
数千円程度で購入できるため、実験用途には最適だと思います。  

![](https://gyazo.com/9033bf6aa3121b7b6e5c1fc14ea67ed6.png)

※写真の左側がRaspberry Pi本体です。右側はブレッドボードです。  
　画面が暗くて申し訳ありません。その他の機器も一緒に詰め込んでいるラックの中を写しています。

上記は、筆者が知的好奇心を満たすために自宅で使用している「Raspberry Pi 3B+」というタイプの機器です。大きさは手のひらサイズです。  

2022/09/03現在、Raspberry Pi 4 のバージョンまで販売されているようです。  
またRaspberry Piシリーズには他にも「Zero」、「Pico」というもっと廉価版のタイプも販売されているので、スペックと予算に応じて機種を選択できます。

似たようなIoT機器に[Arduino](https://ja.wikipedia.org/wiki/Arduino)があります。  
ArduinoはRaspberry Piよりも更に安価に購入できます。  

![](https://gyazo.com/751140ae0c4b9ec5a3982ed7f0e75f91.png)

筆者が持っているのはUNOというタイプです。  
価格は1500円程度だったでしょうか。Raspberry Piほどの自由度は無いですが、USBケーブルでパソコンに接続し、Arduino IDEという専用の開発アプリケーションを利用するだけで、基盤に付いているLEDをプログラムからチカチカさせたりできます。

他にも[Jetson nano](https://www.nvidia.com/ja-jp/autonomous-machines/embedded-systems/jetson-nano/)など、面白いデバイスは数多くありますが、今後は主にRaspberry PiというIoTデバイスを使って話を進めていきたいと思います。

## とりあえず、IoTを試す

概要の説明ばかりしていても面白くないので、能書きはそろそろ終えて、”とりあえず”、AWS IoTのサービスからIoT機器を利用してみましょう。  
今回はAWSで公開されているIoT機器接続を簡単に試す手順を実行してみます。    
当然ですが「AWSのアカウント」を持っていることが条件です。

AWSにいくつかIoTチュートリアルがあるので、今回はそのうちの
[「AWS IoT クイック接続を試してみましょう」](https://docs.aws.amazon.com/ja_jp/iot/latest/developerguide/iot-quick-start.html)に従って話を進めます。  
(上記のURLを進めていくと、説明の内容と実際に表示される内容にかなり食い違いがありますが、やろうとしていることは同じようなので、表示される内容に従ってチュートリアルを進めていきます)

使用するAWS IoTサービスは、以下の「AWS IoT Core」がメインになります。

![](https://gyazo.com/0358a950df284ded76ad623a969c47ca.png)

その他のサービスについては別の機会に紹介していきます。

## チュートリアル「AWS IoT クイック接続を試してみましょう」

今回、接続するIoTデバイスは「Raspberry Pi 3b+」(以降、Raspiと称します)を想定します。  
Raspiがインターネットに接続できるように環境設定は済ませておいてください。

AWSコンソールにログインし、サービス「IoT」－「IoT Core」を選択します。

![](https://gyazo.com/6123f1a9478d3bfb956f7445ab4c18c0.png)

以下のような画面が表示されます。

![](https://gyazo.com/c6c19d1d813f9db6a5e715bde8fd4e12.png)

左側のメニューの下の方に「学習」という項目がありますので、「学習」を選択します。

![](https://gyazo.com/87fac9031f89896b2851b4178750b017.png)

次に「AWS IoT に接続する」というタイトルの中の「接続オプションの表示」を選択します。

![](https://gyazo.com/91ba2633d5e6a4eeac8e558b064bdace.png)

「AWS IoT > 接続 > 1個のデバイスを接続」という画面が表示され、  
「Step1 デバイスを準備する」が選択されている状態になります。

![](https://gyazo.com/3a6437dd89024c360ef3c16e6e21d109.png)

Raspiを起動し、Raspiに直接またはターミナルソフトでログインします。  
RaspiからAWSに接続できるかどうか Pingでチェックを行います。  
(AWS側のエンドポイントはNo.4の手順の内容をコピーすれば、確実です)

Pingが通らない場合はRaspiからAWSに接続ができていません。  
自宅／会社のネットワークのルーティング等の確認をしてください。

「次へ」ボタンを押します。

Step2では「新しいモノを作成」を選択し、モノの名前を決めて設定します。  
ここでは  
  `test-device-01`  
としました。  

![](https://gyazo.com/84cf46fb66be25fb1f1bbb48bc2efa7b.png)

「追加設定」のその他のオプションはそのままにして「次へ」を押します。  
（今回紹介しなかったオプションについてはまた別の機会に詳細を解説します）

Step3ではIoTデバイス側の「OS」と、接続に使用するIoTデバイス側の「AWS IoT デバイス SDK」を選択します。

![](https://gyazo.com/546d88ab815d7ea8c0781ef0c480db9d.png)

上記では  
- OS: Linux/macOS
- SDK: Python

を選択しました。  
RaspiのOS「Raspbian」はLinux系OSなので「Linux/macOS」を選択しています。  
SDKは筆者の好みでPythonを選択しました。  
(注意：AWS IoT デバイス SDKでPythonを選択した場合、Raspi側でPython3系が使用可能であることが条件です。RaspiへのPython3系のインストールは各自実施しておいてください)

「次へ」を押します。 

Step4では「接続キット」をダウンロードします。  
以下のファイル名でダウンロードされます。  
  `connect_device_package.zip`

このキットの中には接続時に使用するセキュリティキーの公開鍵、秘密鍵、証明書、ポリシーファイル等が含まれています。  
チュートリアルではこれらのファイルはすべて一つのZipファイルに同梱されてダウンロードされます。   
個別に設定を進める場合は、個々にファイルをダウンロードすることになります。  

![](https://gyazo.com/eba7a46535c8114fea50b2fd5543e2b3.png)

画面上の「接続キットをダウンロード」ボタンを押すと、操作をしているブラウザが動作しているパソコン上に接続キットがダウンロードされます。  
Raspi以外のパソコンにファイルをダウンロードした場合は、FTP等のファイル転送プロトコルで「connect_device_package.zip」ファイルをRaspiに転送し、Raspi上で解凍してください。

解凍が完了すると以下のようなファイルが展開されているはずです。  
(TerminalソフトでRaspiにログインして確認しています)  

![](https://gyazo.com/756a017287f94bcccbe1848b3a3d9ecd.png)

ファイルが展開されていることを確認したら「次へ」を押します。 

以下のような画面になっていると思います。

![](https://gyazo.com/3f2aa23c6204d490512744c2d55b30b5.png)

画面に書かれているように、先程展開したファイルの中の  
`start.sh`  
ファイルに実行権限をつけます。

```shell
chmod +x start.sh
```

その後、start.sh を実行します。  

```shell
./start.sh
```

シェルスクリプトが実行されると、以下のような実行結果がターミナル上に表示されていくと思います。  

![](https://gyazo.com/28f5f02d44e9174a0297f6acce8e4547.png)

続いて、このままの状態でブラウザ側を確認すると、先程の「サブスクリプション」のエリア「sdk/test/Python」に数秒おきにデータが受信されていることが確認できると思います。

![](https://gyazo.com/32f167bef282cbf5e8309621f798cd7e.png)

今回の接続モデルは  
- AWS IoT側がサブスクライバー
- Raspi側がパブリッシャー

のPub/Subモデルになっています。  
Raspi側で送信を中止するか、AWS IoT Core側でサブスクライブを中止して、接続を切ります。

「続行」ボタンを押します。  
これまでの操作で、一通りの接続確認は完了しました。  

![](https://gyazo.com/8df4a8222178d2d9e19a699a38f1137c.png)

「モノを表示」を押します。  
先程作成した”モノ”に関する詳細情報が確認できます。

![](https://gyazo.com/7d3389c093d83ebaed606f15b95a87a0.png)

モノが不要になった場合は「削除」ボタンを押して、モノを削除します。  

注意：モノだけ削除しても、チュートリアルによって自動的に作成された”証明書”、”ポリシー”は削除されないので、それも不要ならば個別に削除します

![](https://gyazo.com/4e7685875d3382c31256abe69425405a.png)

## まとめ

今回は「AWS IoTチュートリアル」に沿って、1つのIoTデバイスのみAWS IoTに接続し、IoTデバイス(Raspi)側からAWS IoTクラウドにメッセージを送信(パブリッシング)できることを確認しました。  
本来は個別にポリシーの作成、証明書の発行やグループ・タイプの設定等を行うのですが、今回はチュートリアルをそのまま実行し、”とりあえず繋いでみる” を優先しました。  

次回以降、AWS IoTに用意されているサービスを更に詳しく見ていこうと思います。
