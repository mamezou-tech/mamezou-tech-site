 ---
 title: UMLformatガイドfor2.5.1 -ペトリネット編-
 author: kotaro yaehata
 # 公開日として設定されますので、それを考慮した日付にするようにしてください
 date: 2025/4/22
 # 以下のタグは任意です。つけるものあれば追加してください。まず既存タグ(トップページにあります)に使えるものがあるかを確認してください。なければ新規に作成してもらって大丈夫です
 tags: [mamezou][UML][MBSE]
 ---
 # UMLformatガイド ペトリネット編
 ## この記事の目的
 自分を中心にコンサルタント業務にUMLを活用する際、UMLの規格を正確に把握しておくことは、モデリングの質を向上させる際
 非常に重要だと思い、備忘録も兼ねて本記事を作成した。<br>
 本記事は以下を目的とする。<br>
 1. モデルの書き方を理由としたレビュー指摘を少なくし、成果物の質を上げる<br>
 2. 要求分析業務等でモデルを作るときに、自分が作るモデルが何を意味するのか正しく理解できるようになる<br>
 3. モデルが何を意味するか理解することで、お客様にモデルの説明を行いやすくする<br>
<br>
UMLformatではペトリネットの考え方がたびたび出るため、今回はペトリネットについて取り上げる<br>

## ペトリネットって？
ペトリネットは、1962年にカール・アダム・ペトリが発表した離散分散システムを数学的に記述するために発明された
方法である<br>
(離散分散システム：スマートホームシステムのように、リビングのライトの調整、エアコンの調整といった、並行した個々で分散した動作をつなぎ合わせて一つのシステムを実現しているもののこと)<br>
<br>
じゃあどのような場面で使用できるのか？の疑問だが、以下のような用途が考えられる。<br>
1\. 製造工程のモデリング<br>
    製造ラインの様々な要素、例えばマシン、作業者、コンベヤー、品質検査などをノードとして表現し、トークンを用いて動作をシミュレーションできる

2\. ネットワークの分析<br>
    ノードを通信プロトコルとし、トークンを用いてデータパケットを表すと、通信フローを可視化し、ネットワークのボトルネックを特定できる
    
3\. ビジネスプロセスのモデリング<br>
    ノードをビジネスプロセスのステップ、トークンはビジネスプロセスの状態としてモデリングする

4\. 鉄道システムのモデリング<br>
    停車駅をノード、トークンを列車のようにして鉄道輸送のモデリングを行うことができる。
<br><br>
例えばactivity図で任意のシステムをモデリングした場合、システムがどんな振る舞いをするのかを理解できるが、イベント間（アクション）での状態変化
を表現するのは難しいし、時間軸的振る舞いを表現しずらい。<br>
顧客からそういったモデルを要求された場合、ペトリネットを使って説明・表現できる場合があると思うので、役に立つかもしれない。

## ペトリネットについて詳しく
ペトリネットを書くために必要な要素は以下<br>
ペトリネットは、プレース（状態）とトランジション（事象）、これらを接続する線（入力線、出力線）、トークンで構成されている。<br>
1. プレース<br>
   状態を表す円形のノード
2. トランジション<br>
   状態の変化を表す四角形のノード
3. 入力線<br>
   前状態からトランジションに接続される、トランジションが発火するために必要な場所を表す線
4. 出力線<br>
   トランジションから後状態に接続される、トランジションが発火した結果、次の状態に遷移するために使用される場所を表す線
5. トークン<br>
   プレースの内部に配置される黒丸でシステムの局所的状態、つまり今どのプレースにリソースが存在するのかを示す
<br><br>
これはオーソドックスな単純ペトリネットを構成する要素である<br>
単純ペトリネットは並列処理のモデリングに有用で、複数のプロセスがそれぞれ独立していて実行される　といった状況をモデリングするのに最適である。<br>
注意点として、単純ペトリネットは比較的単純な問題しかモデリングすることができない<br>
<br>
この単純ペトリネットのモデリング例を表すと以下になる。<br><br>
![単純ペトリネット](/img/petrinet/petrinet.jpg)
<br>
これを踏まえてオールドファッションを作る工程を例としてペトリネットで表現してみる。<br>
まず、オールドファッションを作るにはドーナツとそれをコーティングするチョコが必要なので
原料としての揚げてないドーナツとチョコソースに加工する前のチョコがプレースとしてある<br>
もちろんこの状態ではトークンはドーナツ、チョコ両方とも一番左のプレースに存在する<br>
![ペトリネットの例](/img/petrinet/petrinet_ex1.jpg)
<br>
ここでドーナツを揚げると、トランジション「ドーナツを揚げる」が発火してトークンが前状態から後状態に移る<br>
![ペトリネットの例](/img/petrinet/petrinet_ex2.jpg)
<br>
さらにチョコをコーティング用にチョコソースに加工するとトランジション「チョコをソースに加工する」が発火して、
トークンが前状態から後状態に移る<br>
![ペトリネットの例](/img/petrinet/petrinet_ex3.jpg)
<br>
最後に仕上げとしてチョコソースをドーナツにコーティングするとトランジション「ドーナツをチョコにコーティングする」が発火して
二つのトークンが２つの前状態から後状態へ移る<br>
![ペトリネットの例](/img/petrinet/petrinet_ex4.jpg) 

## ペトリネットの規則
ペトリネットでは、トークンについては特に制約があるため、ここではその説明をする。
### 状態表現
1. プレースはそこに入るトークンの個数によりシステムの局所的状態を表現する
2. 1つのトークンは1つの資源に対応する。任意のプレースにトークンがk個置かれていればk個の資源がそのプレースに存在することを示す
3. 同じプレース内に複数のトークンがあった場合、それらは区別されない
<br>
つまり、トークンはそのプレースにその時間軸で資源がいくつあるのかを示すのであって何のトークン（資源）が存在するかといったことは考慮しない
<br>

### 状態遷移規則
1. トランジションは各入力プレース（前状態）に矢印（arc）の本数以上のトークンが存在するときに発火（実行）可能である
   1. ※矢印は1本の矢印+整数値で矢印を複数本示すこともできる
2. トランジションが発火すると、各入力プレースから矢印の本数だけのトークンが失われ、出力プレース（後状態）に矢印の本数だけのトークンが加えられる
<br>
つまり、ペトリネット全体でトークンの数は変化することはなく、矢印の本数より多いトークンの移動はない。<br>
最後にトランジション発火前後のトークンの移動イメージは以下
<br>
<br>
![遷移後のトークン例](/img/petrinet/petrinet_token.jpg)
<br>

## 終わりに
私もUMLformatをひも解くのを機にペトリネットのことを知りましたが、UMLより原始的ながらも直観的にわかりやすい表現技法だなと思いました。<br>
UMLはわからないor知らないお客様にモデルベースでプロセスを説明する手段としてはかなりわかりやすい方法ではないかなと思います。