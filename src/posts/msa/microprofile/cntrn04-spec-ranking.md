---
title: 第4回 使って分かった！お勧めMicroProfile仕様厳選3選
author: toshio-ogiwara
date: 2022-03-10
tags: ["逆張りのMicroProfile"]
prevPage: ./src/posts/msa/microprofile/cntrn03-sampleapp-helidon.md
eleventyExcludeFromCollections: true
---

MicroProfileはトップレベルの仕様以外も含めると大小様々な仕様が存在しています。 前回紹介したサンプルアプリのレンタル品予約システムにMicroProfileの各機能を組み込んでフィット感を試してみた結果、MicroProfileを採用するのであれば『これは抑えておくベキ、もしくは使っておくベキ』と言える仕様がいくつかありました。今回はその中から厳選した3つの仕様を紹介したいと思います。

なお、APIまでまとめて説明するのはムリがあるため、今回はどんなことができるかの機能レベルを紹介し、次回以降3回に分けてAPIも含めた利用法を説明していきたいと思います。

それでは早速ランキング発表に行ってみたいと思います！

# 第1位 MicroProfile RestClient
REST通信にはREST APIを呼び出す側のRESTクライアントとREST APIを公開しRESTクライアントから呼ばれる側のRESTリソースの2つが登場します。

JAX-RSを使ってRESTクラアントを実装する場合、JAX-RSのWebTargetクラスを使い、リクエストの送信とレスポンスの受信に対する冗長な実装が必要となりますが、これがMicroProfile RestClientを使うとなんと！RESTクライアントの実装が不要となります。

必要となるのは呼び出すREST APIを表したJavaのインタフェースのみとなります。必要な呼び出し処理はMicroProfileのランタイムにより、インタフェースに基づいたProxyが生成され処理されます 。

![restclient](../../../img/mp/restclient.drawio.svg)

また呼び出す相手がJavaであればOAS([Open API Specification](https://spec.openapis.org/oas/latest.html))ドキュメントを経由せず、フロントエンドとバックエンドの入出力インタフェースにJavaのインタフェースレベルでズレがないことを確認、担保できる点もすごく良いと思います

# 第2位 MicroProfile Config
マイクロサービスなアプリケーションはポータブルである必要があります。

このため、内部で持っている設定をアプリケーション外部の環境変数などで値を上書きしたり、または同じ設定を複数の設定源が持っていた場合、設定源ごとに優先度を定義し値を決定するといった機能が必要となります。

MicroProfile Configは正にこのような設定が考慮された設定機能の仕様となります。
例えば下の図のようにjarの内部で開発用の接続先情報を持たせて、環境ごとに環境変数でこの設定を変更するといったことが簡単にできるようになります。

![config](../../../img/mp/config.drawio.svg)

また、MicroProfile ConfigはJava SE環境で動作可能でCDI必須としません。ですので、MicroProfileとしてではなく、このConfig機能だけでも単独で利用することができます。また、これ単独でも利用したくなるくらい使い勝手のより設定機能と言えます。

# 第3位 MicroProfile OpenAPI
REST APIの仕様はOASに沿った形式で記述するのが最近のスタンダートとなりつつありますが、MicroProfile OpenAPIはこのOASをコードから生成するためのアノテーションと生成したOASの公開方法を定めた仕様となります。

と言ってもピンと来ないかと思いますので動作イメージを説明すると下の図のようになります。

![openapi](../../../img/mp/openapi.drawio.svg)

図から分かるとおり、MicroProfile OpenAPIを利用することで、『REST APIを公開しているサーバ自身が自身が動作させているモジュールから取得した情報をもとにAPI仕様を返却する』と言った、ある意味完全なまでの実装と仕様の一致を実現する ことが可能となります。

またもう一つのメリットは、ソースをもとにしたOASドキュメントの自動生成になります。コードから解釈できないパラメータの意味などは当然アノテーションで意味を明示する必要がありますが、コードから解釈できるものはアノテーションを付けなくともコードをもとにかなりの程度、OASドキュメントを自動で生成してくれます。

特にOASドキュメントを手で書いていて一番手間が掛かるものとして、入出力に利用するDTOの定義がありますが、これはなにも手を掛けずとも使用に十分耐える程度のOASドキュメントをコードから生成してくれます。すごく便利です！

# まとめ
厳選3仕様、いかがでしたでしょうか。使ってみたいなと少しでも思っていただけたら幸いです。次回は3回に分けて今回紹介したそれぞれの仕様についてAPIレベルで利用法を紹介していきたいと思います


