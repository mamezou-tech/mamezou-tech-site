---
title: 豆蔵社員のリモートワーク環境ご紹介 その6 ピタゴラスイッチな切り替え
author: toshio-ogiwara
date: 2022-07-17
tags: リモートワーク環境
---

## はじめに

リモートワークになり自宅端末、業務用端末、開発用端末と複数のPCを使っている方も多いと思います。作業スペースを効率的に使うためにもキーボードやマウス、モニタを1つで済ませられないかを考えてみたものの会社から貸与されているPCはアプリのインストール禁止などの制約があるため、切り替えユーティリティソフトを入れられずどうしたものかと思われている方もいるかと思います。
そんな方に向けて自分なりにたどり着いたスペースは取らないが気がつけばピタゴラスイッチな切り替え環境を紹介したいと思います。

## 筆者の働き方

あるお客さまプロジェクトの豆蔵開発チームのリーダーとして、メンバーの管理や成果物のお客様への説明、ﾁｮｯﾄ難しめの障害調査などを主に行っています。メンバーの管理といってもメンバーの皆さんは優秀で自立して作業を行えるエンジニアなので、基本は放任（放置？）であがってきたコードや成果物を「どれどれ、いいね！」などといいながら確認するのが主な作業となります。ですので、管理といっても、実際はIDEでコードを追っていたり、エディタで障害時のログをジーっと眺めていたりするのが主だったりします。

業務でコードをガリガリと書くことは今はないですが、業務外では、このような記事を書くための技術調査としてコードを結構書いていたりもします（今回のネタは実装ネタではないですが、他では[こんな記事](https://developer.mamezou-tech.com/authors/toshio-ogiwara/)を書いています）

このようなことで仕事環境としては大きなモニタと使い慣れたキーボードとマウスのセットが気持ち良く仕事をする上で必須となります。

## 使用機器の紹介
気持ちよく仕事をする上で必須といっていたモニタやキーボードとしてどのようなものを使っているかを紹介した後に、そのピタゴラスイッチな接続構成を紹介したいと思います（写真でみると意外とスッキリした感じはありますが、、）

![全景](https://i.gyazo.com/ae29e2f74df516f4d21730e94f104c9e.jpg)


### 仕事で使うPC
何はともあれまずはPC本体ですが仕事では次の2台のノートPCを常時使って作業をしています。

 - 所属会社である豆蔵から貸与されているノートPC（豆蔵PC）
かなりハイスペックなLet’Note(Win10 Pro)。ローカルの管理者権限も与えられているため一定の制約やルールはあるもののアプリのインストールは基本OK。

 - お客様から貸与されているノートPC（お客様PC）
そこそこハイスペックなノートPC(Win10 Pro)。従事しているプロジェクトが金融ドメインの基幹システムのためセキュリティは最高レベル。アプリの勝手インストールなどは当然不可ですし、怖くてやりたいという気は1ミリも起きません。よって利用する周辺機器はドライバインストール不要なことが必須となります。

どちらのノートPCともディスプレイ出力と給電が行えるUSB Type-CやHDMIなど昨今一般的に使われるインタフェースは一通り付いています。


### モニタ
メインのモニタはEIZOの31.5インチの[EV3285](https://www.eizo.co.jp/products/lcd/ev3285/)を使っています。ハッキリいってお高いですが、映りがキレイなことはもちろんですが次の機能があることから奮発して購入しました。

 - 4K(3840×2160)表示が可能
 - USB Type-CやDisplay Port、HDMIの複数入力インタフェースがあり切り替えも可能
 - キーボード、マウスをモニタに繋ぐとPC給電も含めPC本体との接続はUSB Type-Cケーブル1本ですべてまかなえる
 - モニタ自体にキーボードとマウスの切り替えを行うKVM機能[^1]が付いていてキーボードショートカットで切り替えが行える
 - 2台のPCをPicture by PictureやPicture in Pictureで同時に表示できる

[^1]: Keyboard（キーボード） + Mouse（マウス） + Video（映像）の略

2台のPCを常時使うため、この中でも特に４つめのKVM機能と５つめの同時表示にはビビっとくるものがありました。この２つの機能があれば、必要なときにパパっと切り替えができるので、モニタもキーボードもマウスも１つでスッキリできる！と思ったものですが、、、後ほど説明しますがそこには大きな盲点があり、気がつけばピタゴラスイッチになりました。

このモニタは1年間買うかどうか迷っていました。そんなところにリモートワーク環境を紹介する[第1回の記事](/blogs/2022/06/30/remote-env001/)にも登場したあの事業部長がこのモニタを使っていることが分かったため、恐縮しながらもモニタの感想を聞いたところ「控えめに言って最高です！」とのことだったため、購入を決心しました。盲点もありましたが、結果としてはその感想に私も100%同意です。

![EIZO](https://i.gyazo.com/bd83496ec3668cb6fb6ca483c4ede941.jpg)

ただ、後日その事業部長の[宇宙船のようなリモートワーク環境](/blogs/2022/06/30/remote-env001/#こだわりポイント)を見てみると、このモニタをメインモニタではなく、なんとその横にあるサブモニタとしてご利用ではないですか！私が1年間買うか迷っていたお高いモニタがサブモニタ。これを見てガジェット部長、じゃなくて事業部長との格の違いを改めて思い知らされたのは言うまでもありません。

この他に21.5インチのFull HDのサブモニタも使っていますが、これは特筆する点はないので説明は割愛します。

### キーボード
キーボードはやっぱりREALFORCEです(笑。モデルは初代の[91UBK-S](https://www.realforce.co.jp/products/91UBK-S_NG01B0/)を使ってます。REALFORCEは何度も登場してるのでこれ以上の説明は不要ですね。

![キーボード](https://i.gyazo.com/thumb/730/7cb8b60d98d80bbbc8026323a98a7016-jpg.jpg)

過去のリモートワーク環境の紹介記事で続けて何度もREALFORCEが出てきているため「REALFORCEを使わずは豆蔵にあらず」な感じに見えますが、そんなことはなくHHKBも一大勢力を築いています。ですので、今後の登場に期待したいと思います。

### マウス
マウスはロジクールの[M280](https://www.logicool.co.jp/ja-jp/products/mice/m280-wireless-mouse.910-004301.html)を使ってます。アレっ？マウスは拘りを感じないですね。と思われるかも知れませんが、マウス難民の果てにたどり着いた結果がコレです。以前はロジクールのハイグレードなモデルを長く使っていましたが、ある時腱鞘炎になり重いマウスを使うのが苦痛になりました。そのときに腱鞘炎防止用のヘンテコな形をしたエルゴノミクスなマウスや重くても高級なマウスなら実は痛くならないのでは？などと色々なマウスを試しましたが効果はなく、結局軽くて握りがフィットするこのマウスにたどり着きました。

![マウス](https://i.gyazo.com/thumb/694/7e55422c0705b87b3650abf93a95561b-jpg.jpg)

他のリモートワーク環境紹介記事にも腱鞘炎になった話が2回ほどあったので、豆蔵には腱鞘炎になりやすいなにかがあるのか！？と思われるかもしれませんが、そんなことはありません。ちなみに私はその後の精密検査の結果、腱鞘炎ではなく、骨格からくる神経痛ということが分かりました。神経痛は姿勢と日ごろのストレッチでかなりの程度症状を抑えることができていますが、リモートワークではカラダを動かす機会が減るためセルフケアがより重要だと思います（あっ、かなり脱線しましたｗ

## ピタゴラスイッチへの道のり
モニタのKVM機能を使って2台のPCの接続もスッキリ！と思っていましたが、盲点や想定外が重なり切替器や変換器をかませる必要がでてきました。それぞれの機器を最終的にどのように繋いだかは後の [出来上がったピタゴラスイッチな切り替え環境](#出来上がったピタゴラスイッチな切り替え環境) で紹介しますが、その前にどのような切替器（変換器）が増えて行ったかを順に紹介していきます。

### モニタのKVM機能が使えない！自分の環境では・・・
EV3285についているKVM機能はハードウェア的な組み込み機能だと思っていましたが、なんとソフトウェアで実現する機能でした。なので、接続するPCそれぞれにEIZO謹製のユーティリティソフトのインストールと設定が必要でした (ｶﾞﾋﾞｰﾝ。
参考までにそのユーティリティソフトの設定は次のような感じになっています。

![設定1キャプチャ](https://i.gyazo.com/c6251cdfc2e8bf25a487c21bc6560616.png)

このユーティリティソフトですが、豆蔵PCにインストールすることはできますが、上述のPCの説明のとおり、お客様PCにはインストールできません。KVMの切り替えはユーティリティソフトがキーボードショートカットイベントを受信して行うため、このソフトが動作していないPCではいくらショートカットを叩いても切り替えはできません。

よって、豆蔵PCからお客様PCへの切り替えは辛うじてできますが、お客様PCから豆蔵PCへのキーボードショートカットによる切り替えは逆立ちしてもできません（キーボードショートカットで戻ってくることができない、、

ちなみにこのEIZO謹製のユーティリティソフトはWindows版しかありません。Mac&Winな環境で利用する場合も私と同じようなことになるのでご注意を。

### 外付けキーボード／マウス切替器の導入
理想の切り替え環境の夢は早くも崩れましたが、豆蔵PCからはモニタのKVM機能（モニタKVM）が使えるので、なんとかこの切り替え機能を使えないかと思案した結果、モニタとキーボード／マウスを繋ぐ間に別の外付けのキーボード／マウス切替器（外付けKVM[^2]）を繋げて、キーボード／マウスの切り替えは外付けKVMで、そしてモニタの切り替えはモニタKVMで行えばいいのでは！と言うことで、[サンワサプライ キーボード・マウス用パソコン切替器(2:1)](https://www.sanwa.co.jp/product/syohin?code=SW-KM2UU)を導入しました。

[^2]: Video（映像）の切り替え機能は持っていないですがモニタのKVM機能と合わせKVMと表記します。


![KVM](https://i.gyazo.com/8bb9e435678e4f981776701eafaa0a8f.jpg)

この切替器ですが、かなりの優れものです。ソフトウェアのインストールが不要でCtrlボタンの2回連続押しで出力先をPC1→PC2→PC1→PC2→..と切り替えることができます。さらにその切り替えが一瞬です。他の切替器は切り替えてから1テンポ遅れて切り替わる感じですが、この切替器はCtrlボタンを2回連続で押せばほぼタイムラグなしで切り替わります。

キーボードとマウスの他にモニタも接続し切り替えが行えるKVM切替器もありますが、60Hzのリフレッシュレートで4K出力（4K(60)）をサポートするものは現状ありません（多分）。私はメインモニタに4K(60)出力をしたかったため、キーボードとマウスのみの切替器を選択しました。

### サブモニタの追加と接続
利用しているPCについての話しが前後しますが、メールやドキュメント作成などの個人作業はお客様PCで行いますが、お客様PCには使い慣れたツールを自由に利用できない制約があることから、メンバー内でのコミュニケーションは豆蔵PC側で行うことが多くあります。このため、業務中は豆蔵PCとお客様PCの双方が常に見える状況にしておく必要があります。

当初は31.5インチのモニタにPicture in Pictureで2つのPCを同時に表示し１つのモニタで済ませるつもりでしたが、モニタKVMでの切り替えができないこともあり、この作戦は諦めました。代わりに以前使っていたFull HDの21.5インチのモニタをサブモニタとして使い、HDMIの切替器でメインモニタには豆蔵PCを、サブモニタにはお客様PCを出力し、必要に応じてその逆に切り替えるといったような使い方をするようにしました。

HDMIの切替器には沢山の種類がありますが、繋がればなんでもいいかと考え、Amazonで写真のショボい千円の切替器を買いましたが、これは失敗でした。

![HDMI](https://i.gyazo.com/ebcff1dd7529f7fc34a59f7b6f909f24.jpg)

切り替えは写真の真ん中のボタンのON(PC1)／OFF(PC2)で行うのですが、これがたまにうまく切り替わらないときがあります。そんなときは線を抜き差しすると治るのですが、結構イラっとくるので、近いうちに国産のメーカー品に買い替えようと思っています。

### 4K出力できるが60Hzで出力できないHDMIポートが、、、
お客様PCをEIZOのメインモニタに出力すると昔のWindows 3.1（アラフィフの人しか見たことないですね）のように描画がカクカクしているのが気になりました。そこで、なんでかなぁと調べてみたところ、お客様PC自体は60Hzのリフレッシュレートで4K出力が可能なものでしたが、HDMIポートが1.xの古い規格のもでした。このためHDMIで接続すると4K出力はできるがリフレッシュレートが30Hzに落ちてしまうのが原因でした。

と、原因は分かったのですが、60Hzで出力ができるUSB Type-Cはメインモニタとの切り替えをキーボードショートカットで行うため、豆蔵PC側に接続する必要があります。なので、どうしたものかと考えて浮かんだのが、「そうだ！DisplayPortつかおう！」です。モニタ側にDisplayPortはありましたが、お客様PC側にDisplayPortがないため使用を諦めていましたが、DisplayPort⇔USB Type-C変換器をかませてPC側はUSB Type-Cで繋げばイケる気がし、また「かませるもの」が増えるなぁと思いながらも写真のサンワサプライの[USB Type C-DisplayPort変換アダプタ](https://www.sanwa.co.jp/product/syohin?code=AD-ALCDP1401)を買いました。

![アダプタ](https://i.gyazo.com/71b5df0eadf781812cad2ff748e5faa5.jpg)

HDMI切替器と同じように変換アダプタも安いものから少しお高いものまでいくつか種類がありましたが、今回はHDMI切替器と同じ轍を踏まないように少しお高い国産メーカーにしたみましたが、今度は正解でした。全く問題なく4K60Hzで出力できるようになりました！

## 出来上がったピタゴラスイッチな切り替え環境
試行錯誤を経た結果として最終的な接続構成は次のようになりました。多段でKVMを繋げているのが我ながらナカナカな感じですｗ

![図](https://i.gyazo.com/10744de427ba5af96ae28183ca8e20a6.png)


### キーボードとマウスの接続と切り替え
キーボードとマウスはモニタ本体とは別のKVM機器（外付けKVM）に繋ぎ、外付けKVMから出ている2つの切り替え先の1つはモニタに、もう一つはお客様PCに繋ぎます。次にモニタと豆蔵PCをUSB Type-Cで繋ぎます。このように接続することで、外付けKVMのCtrlの2度押しによりキーボードとマウスの接続先を豆蔵PC⇒お客様PCへ、そしてお客様PC⇒豆蔵PCに切り替えることができるようになります。

### メインモニタの接続と切り替え
豆蔵PCとメインモニタはUSB Type-Cで既に繋がっているので、次はお客様PCとメインモニタをDisplay Port（USB Type-C変換あり）で繋ぎます。そして豆蔵PC側にインストールしたEIZO謹製のユーティリティソフトを次のように設定し、Ctrl+1で豆蔵側PCへ、Ctrl+2でお客様PCへ切り替えができるようにします。

![設定2](https://i.gyazo.com/677810721032120a05a5cb50e4c3e33f.png)

こうすることでキーボードの出力先が豆蔵PC側になっているときに`Ctrl+1` or `Ctrl+2`をすることでメインモニタの出力先を切り替えることができるようになります。（キーボードの出力先がお客様PC側になっているときに`Ctrl+1` or `Ctrl+2`をしてもイベントを受信するアプリがいなのでなにも起こりません、、）

## 切り替え操作をしてみる
メインモニタに豆蔵PCが、サブモニタにお客様PCが出力さていて、キーボートとマウスの出力先が豆蔵PC側になっているのを逆にする場合は
![豆蔵→お客様](https://i.gyazo.com/0742a9964d55b5c9c408d818c04f3e9a.png)
のように操作すると、Ctrl+2でメインモニタを豆蔵PC⇒お客様PCへ、HDMI切替器のOFFでサブモニタをお客様PC⇒へ豆蔵PCへ、Ctrlを2回でキーボードとマウスの出力先を豆蔵PC⇒お客様PCに切り替え、お客様PCをメインに作業ができるようになります。

これを今度は逆に戻す場合は、
![お客様→豆蔵](https://i.gyazo.com/991ca4ff34dd679795e46cb1692570f9.png)
と先ほどとは逆の操作をしていくことで戻すことができます。

## 頑張ってみた感想
Ctrlの2度押しの順番を間違えると、アレ、入力どこ行った？やアレ、これって出力どこ行くんだっけ？というような若干パズルのような切り替えになっていますが、切り替えは頻繁に行うものではなく、また物理的に移動したり繋ぎ変えたりをする必要もないため、色々ある制約の中で当初目標としていた「大きなモニタと使い慣れたキーボードとマウスのセットで気持ち良く仕事をする」ことはできているため、自分的には大変満足しています。

ただ、その引き換えに配線が増え机の周りが雑然とした感じになってしまったので時間がある時にでも配線はキレイにまとめて目につかないようにしたいと思っています。

